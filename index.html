<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cenov√° ponuka</title>

<!-- FONT: Onest -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ===============================
   BASE
================================ */
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family:"Onest", system-ui, sans-serif;
  background:#fff;
  color:#000;
}
.wrap{
  max-width:1200px;
  margin:0 auto;
  padding:24px;
}

h1{
  margin:0 0 16px 0;
  font-size:28px;
  font-weight:800;
}

/* ===============================
   BUTTONS
================================ */
.toolbar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-start;
  margin-bottom:16px;
}
.btn{
  border-radius:999px;
  padding:10px 16px;
  border:1px solid #000;
  background:#fff;
  font-weight:700;
  cursor:pointer;
}
.btn.primary{
  background:#000;
  color:#fff;
}
.btn.secondary{
  background:#f2f2f2;
  border-color:#d0d0d0;
}
.btn.ghost{
  background:#fff;
  border-color:#d0d0d0;
  font-weight:700;
}
.hint{
  color:#666;
  font-size:13px;
  margin-top:2px;
}

/* ===============================
   FORM ELEMENTS
================================ */
label{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.08em;
  font-weight:800;
  display:block;
  margin-bottom:4px;
  color:#111;
}
input, select{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #ccc;
  font-family:inherit;
  font-size:14px;
}
input[type="number"]{ text-align:right; }

/* ===============================
   CARDS
================================ */
.card{
  border:1px solid #ddd;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
.card h2{
  margin:0 0 12px 0;
  font-size:18px;
  font-weight:800;
}
.card h3{
  margin:0 0 10px 0;
  font-size:15px;
  font-weight:800;
}

/* ===============================
   GRID HELPERS
================================ */
.grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; }
.grid-4{ display:grid; grid-template-columns:2fr 1fr 1fr 1fr; gap:14px; }
@media (max-width: 900px){
  .grid-2,.grid-3,.grid-4{ grid-template-columns:1fr; }
}

/* ===============================
   SECTION EDIT
================================ */
.section-editor{
  border:1px solid #ddd;
  border-radius:16px;
  padding:14px;
  background:#fff;
}

.items{
  margin-top:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.item{
  border:1px solid #ddd;
  border-radius:14px;
  padding:12px;
}
.item-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}
.item-head .left{
  font-weight:800;
}
.icon-btn{
  width:40px;
  height:40px;
  border-radius:999px;
  border:1px solid #d0d0d0;
  background:#f2f2f2;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}
.item-foot{
  margin-top:10px;
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}

.price-block{
  text-align:right;
  min-width:220px;
}
.price-old{
  font-size:12px;
  color:#777;
  text-decoration:line-through;
  min-height:16px;
}
.price-main{
  font-weight:800;
  font-size:18px;
}
.price-period{
  margin-top:2px;
  font-size:11px;
  color:#777;
}
.price-period input{
  border:none;
  padding:0;
  text-align:right;
  color:#777;
  background:transparent;
  font-size:11px;
}

.toggle-row{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
  margin-top:10px;
}
.toggle-row label{ margin:0; }
.small{
  font-size:12px;
  color:#666;
}

/* ===============================
   PRINT / PDF VIEW
================================ */
.print-view{ display:none; }

.print-page{
  width:210mm;
  min-height:297mm;
  margin:0 auto;
  background:#fff;
  border:2px solid #000;
  padding:18mm 14mm;
  position:relative;
}

/* rezerva pre obr√°zky */
.pv-gutter{
  position:absolute;
  left:14mm;
  top:18mm;
  bottom:18mm;
  width:42mm;
}

/* obsah posunut√Ω doprava */
.pv-content{
  margin-left:48mm;
}

/* hlaviƒçka hore vƒæavo */
.pv-header{
  margin-bottom:18mm;
}
.pv-title{
  font-size:34px;
  font-weight:800;
}
.pv-subtitle{
  font-size:16px;
  margin-top:4px;
  font-weight:500;
}

/* sekcie */
.pv-section{
  margin-top:14mm;
}
.pv-section-name{
  font-size:13px;
  font-weight:700;
}
.pv-section-period{
  margin-top:2mm;
  font-size:12px;
  font-weight:500;
  color:#111;
}

/* tabuƒæka */
.pv-table{
  margin-top:6mm;
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  font-size:11.5px;
}
.pv-table th{
  text-align:left;
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:.08em;
  border-bottom:1px solid #000;
  padding-bottom:6px;
}
.pv-table td{
  padding:8px 0;
  vertical-align:top;
}

.c-item{ width:34%; }
.c-spec{ width:20%; }
.c-qty{ width:10%; text-align:right; }
.c-price{ width:12%; text-align:right; }
.c-disc{ width:12%; text-align:right; }
.c-total{ width:12%; text-align:right; }

.pv-item-title{ font-weight:700; }
.pv-item-note{
  font-size:10.5px;
  margin-top:2px;
  color:#111;
}
.pv-item-period{
  margin-top:3px;
  font-size:10px;
  color:#777;
}

.pv-divider{
  margin-top:10mm;
  border-top:1px solid #000;
}

/* ===============================
   PRINT RULES
================================ */
@media print{
  .wrap{ display:none !important; }
  .print-view{ display:block !important; }

  body{ margin:0; }
  @page{ margin:0; }
}
</style>
</head>

<body>

<div class="wrap">
  <h1>Cenov√° ponuka ‚Äì formul√°r</h1>

  <div class="toolbar">
    <button class="btn primary" id="btnPrint" type="button">Export do PDF</button>
    <button class="btn secondary" id="btnAddItem" type="button">+ Prida≈• polo≈æku do sekcie</button>
    <button class="btn ghost" id="btnReset" type="button">Vymaza≈• (demo)</button>
  </div>
  <div class="hint">Tip: pri exporte do PDF sa vytvor√≠ ‚Äûƒçist√Ω‚Äú layout (r√°mik, posun doprava, sekcie). Obdobie pod cenou je default ‚Äûza 3 mesiace‚Äú.</div>

  <!-- Z√ÅKLAD PONUKY -->
  <div class="card">
    <h2>Z√°klad ponuky</h2>
    <div class="grid-2">
      <div>
        <label for="offerTitle">N√°zov ponuky</label>
        <input id="offerTitle" value="Cenov√° ponuka">
      </div>
      <div>
        <label for="offerSubtitle">Podnadpis</label>
        <input id="offerSubtitle" placeholder="napr. laluna" value="laluna">
      </div>
    </div>
  </div>

  <!-- SEKƒåIA (zatiaƒæ 1) -->
  <div class="card">
    <h2>Sekcia</h2>

    <div class="section-editor" id="sectionEditor">
      <div class="grid-2">
        <div>
          <label for="secName">N√°zov sekcie</label>
          <input id="secName" value="Komunik√°cia v ƒçak√°rni pediatra">
        </div>
        <div>
          <label for="secPeriod">Obdobie</label>
          <input id="secPeriod" value="Q4 2026">
        </div>
      </div>

      <div class="toggle-row">
        <div style="min-width:280px;">
          <label for="showTotals">Zobrazi≈• ‚Äûcena spolu‚Äú v PDF?</label>
          <select id="showTotals">
            <option value="yes" selected>√Åno</option>
            <option value="no">Nie</option>
          </select>
        </div>

        <div class="small">Pozn.: keƒè je zv√Ωhodnen√° cena vyplnen√°, v PDF zobraz√≠me aj p√¥vodn√∫ (pre≈°krtnut√∫).</div>
      </div>

      <div class="items" id="items"></div>
    </div>
  </div>
</div>

<!-- ===============================
     PRINT VIEW (PDF)
================================ -->
<section class="print-view" id="printView">
  <div class="print-page">
    <div class="pv-gutter"></div>

    <div class="pv-content">
      <div class="pv-header">
        <div class="pv-title" id="pvTitle">Cenov√° ponuka</div>
        <div class="pv-subtitle" id="pvSubtitle">laluna</div>
      </div>

      <div id="pvSections"></div>
    </div>
  </div>
</section>

<template id="tplItem">
  <div class="item" data-item>
    <div class="item-head">
      <div class="left">Polo≈æka</div>
      <button class="icon-btn" type="button" title="Odstr√°ni≈• polo≈æku" data-del>üóëÔ∏è</button>
    </div>

    <div class="grid-2">
      <div>
        <label>Typ produktu</label>
        <select data-type>
          <option value="">‚Äî vyber ‚Äî</option>
          <option value="B1">B1 plag√°t</option>
          <option value="LETAKY">Umiestnenie let√°kov do stojanov IDS</option>
        </select>
      </div>
      <div>
        <label>Rozmer</label>
        <input data-dim placeholder="‚Äî">
      </div>
    </div>

    <div class="grid-2" style="margin-top:12px;">
      <div>
        <label>N√°zov (vlastn√Ω text)</label>
        <input data-name placeholder="napr. B1 plag√°t">
      </div>
      <div>
        <label>Doplnenie / pozn√°mka (voliteƒæn√©)</label>
        <input data-note placeholder="napr. + umiestnenie let√°kov do u≈°ka">
      </div>
    </div>

    <div class="grid-3" style="margin-top:12px;">
      <div>
        <label>Cena za kus</label>
        <input data-price type="number" min="0" step="0.01" placeholder="0.00">
      </div>
      <div>
        <label>Zv√Ωhodnen√° cena za kus</label>
        <input data-discount type="number" min="0" step="0.01" placeholder="0.00">
      </div>
      <div>
        <label>Poƒçet</label>
        <input data-qty type="number" min="0" step="1" value="1">
      </div>
    </div>

    <div class="item-foot">
      <div style="min-width:260px;">
        <label>Obdobie pod cenou</label>
        <input data-period value="za 3 mesiace">
      </div>

      <div class="price-block">
        <div class="price-old" data-old></div>
        <div class="price-main" data-total>0,00 ‚Ç¨</div>
        <div class="price-period">(poƒç√≠tan√© z jednotkovej ceny)</div>
      </div>
    </div>
  </div>
</template>

<script>
/* ===============================
   UTIL
================================ */
const moneyFmt = new Intl.NumberFormat('sk-SK', { style:'currency', currency:'EUR' });

function n(v){
  const x = Number(v);
  return Number.isFinite(x) ? x : 0;
}

function formatMoney(val){
  return moneyFmt.format(val);
}

function presetForType(type){
  // Sem nesk√¥r dopln√≠≈° ƒèal≈°ie prednastavenia
  if(type === 'B1'){
    return { dim: '70 √ó 100 cm', name: 'B1 plag√°t', note: '+ umiestnenie let√°kov do u≈°ka' };
  }
  if(type === 'LETAKY'){
    return { dim: '', name: 'Umiestnenie let√°kov do stojanov IDS', note: '' };
  }
  return { dim:'', name:'', note:'' };
}

/* ===============================
   EDIT: ITEMS
================================ */
const itemsWrap = document.getElementById('items');
const tplItem = document.getElementById('tplItem');

function recalcItem(itemEl){
  const price = n(itemEl.querySelector('[data-price]').value);
  const discount = n(itemEl.querySelector('[data-discount]').value);
  const qty = n(itemEl.querySelector('[data-qty]').value);

  const unit = discount > 0 ? discount : price;
  const total = unit * qty;

  // total
  itemEl.querySelector('[data-total]').textContent = formatMoney(total);

  // old price shown only if discount > 0 and price > 0
  const oldEl = itemEl.querySelector('[data-old]');
  if(discount > 0 && price > 0){
    oldEl.textContent = formatMoney(price);
  } else {
    oldEl.textContent = '';
  }
}

function wireItem(itemEl){
  const typeSel = itemEl.querySelector('[data-type]');

  // preset on type change
  typeSel.addEventListener('change', () => {
    const p = presetForType(typeSel.value);
    const dimEl = itemEl.querySelector('[data-dim]');
    const nameEl = itemEl.querySelector('[data-name]');
    const noteEl = itemEl.querySelector('[data-note]');

    // Rozmer v≈ædy nastav (pri B1), pri in√Ωch vyma≈æ
    dimEl.value = p.dim;

    // N√°zov + pozn√°mka nastav len ak s√∫ pr√°zdne (aby obchodn√≠kovi neprepisovalo jeho text)
    if(!nameEl.value) nameEl.value = p.name;
    if(!noteEl.value && p.note) noteEl.value = p.note;

    recalcItem(itemEl);
  });

  // recalc on input
  itemEl.querySelectorAll('input').forEach(inp => {
    inp.addEventListener('input', () => recalcItem(itemEl));
  });

  // delete
  itemEl.querySelector('[data-del]').addEventListener('click', () => {
    itemEl.remove();
  });

  // initial calc
  recalcItem(itemEl);
}

function addItem(prefillType = 'B1'){
  const node = tplItem.content.cloneNode(true);
  const itemEl = node.querySelector('[data-item]');

  itemsWrap.appendChild(node);

  const actualItem = itemsWrap.lastElementChild;
  wireItem(actualItem);

  // optionally prefill by type
  if(prefillType){
    const sel = actualItem.querySelector('[data-type]');
    sel.value = prefillType;
    sel.dispatchEvent(new Event('change'));
  }
}

/* ===============================
   PDF RENDER
================================ */
function getItemsData(){
  const arr = [];
  itemsWrap.querySelectorAll('[data-item]').forEach(itemEl => {
    const type = itemEl.querySelector('[data-type]').value;
    const dim = itemEl.querySelector('[data-dim]').value.trim();
    const name = itemEl.querySelector('[data-name]').value.trim();
    const note = itemEl.querySelector('[data-note]').value.trim();

    const price = n(itemEl.querySelector('[data-price]').value);
    const discount = n(itemEl.querySelector('[data-discount]').value);
    const qty = n(itemEl.querySelector('[data-qty]').value);
    const period = itemEl.querySelector('[data-period]').value.trim() || 'za 3 mesiace';

    const unit = discount > 0 ? discount : price;
    const total = unit * qty;

    arr.push({
      type, dim, name, note,
      price, discount, qty, total, period
    });
  });
  return arr;
}

function renderPDF(){
  // header
  document.getElementById('pvTitle').textContent = document.getElementById('offerTitle').value.trim() || 'Cenov√° ponuka';
  document.getElementById('pvSubtitle').textContent = document.getElementById('offerSubtitle').value.trim();

  const secName = document.getElementById('secName').value.trim();
  const secPeriod = document.getElementById('secPeriod').value.trim();
  const showTotals = document.getElementById('showTotals').value === 'yes';

  const items = getItemsData();

  const pvSections = document.getElementById('pvSections');
  pvSections.innerHTML = '';

  // build one section (for now)
  const secDiv = document.createElement('div');
  secDiv.className = 'pv-section';

  const headName = document.createElement('div');
  headName.className = 'pv-section-name';
  headName.textContent = secName || 'Sekcia';
  secDiv.appendChild(headName);

  const headPer = document.createElement('div');
  headPer.className = 'pv-section-period';
  headPer.textContent = secPeriod || '';
  secDiv.appendChild(headPer);

  // table
  const table = document.createElement('table');
  table.className = 'pv-table';

  // thead
  const thead = document.createElement('thead');
  const trh = document.createElement('tr');

  const headers = [
    { cls:'c-item', txt:'Polo≈æka' },
    { cls:'c-spec', txt:'≈†pecifik√°cia' },
    { cls:'c-qty', txt:'Poƒçet' },
    { cls:'c-price', txt:'Cena' },
    { cls:'c-disc', txt:'Zv√Ωh. cena' }
  ];
  headers.forEach(h => {
    const th = document.createElement('th');
    th.className = h.cls;
    th.textContent = h.txt;
    trh.appendChild(th);
  });

  const thTotal = document.createElement('th');
  thTotal.className = 'c-total';
  thTotal.textContent = 'Cena spolu';
  trh.appendChild(thTotal);

  thead.appendChild(trh);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');

  items.forEach(it => {
    const tr = document.createElement('tr');

    // item
    const tdItem = document.createElement('td');
    tdItem.className = 'c-item';
    const title = document.createElement('div');
    title.className = 'pv-item-title';
    title.textContent = it.name || it.type || '‚Äî';
    tdItem.appendChild(title);

    if(it.note){
      const note = document.createElement('div');
      note.className = 'pv-item-note';
      note.textContent = it.note;
      tdItem.appendChild(note);
    }

    // period under price (as requested)
    const per = document.createElement('div');
    per.className = 'pv-item-period';
    per.textContent = it.period ? it.period : 'za 3 mesiace';
    tdItem.appendChild(per);

    tr.appendChild(tdItem);

    // spec/dim
    const tdSpec = document.createElement('td');
    tdSpec.className = 'c-spec';
    tdSpec.textContent = it.dim || '';
    tr.appendChild(tdSpec);

    // qty
    const tdQty = document.createElement('td');
    tdQty.className = 'c-qty';
    tdQty.textContent = String(it.qty || 0);
    tr.appendChild(tdQty);

    // price (show old if discount? -> we show price normally, and if discount exists, the discounted column will show it)
    const tdPrice = document.createElement('td');
    tdPrice.className = 'c-price';

    // If discount exists, show old price with line-through in PDF in the price column
    if(it.discount > 0 && it.price > 0){
      const old = document.createElement('div');
      old.style.textDecoration = 'line-through';
      old.style.color = '#777';
      old.style.fontSize = '10.5px';
      old.textContent = formatMoney(it.price);
      tdPrice.appendChild(old);
    } else {
      tdPrice.textContent = it.price > 0 ? formatMoney(it.price) : '';
    }
    tr.appendChild(tdPrice);

    // discount
    const tdDisc = document.createElement('td');
    tdDisc.className = 'c-disc';
    tdDisc.textContent = it.discount > 0 ? formatMoney(it.discount) : '';
    tr.appendChild(tdDisc);

    // total
    const tdTotal = document.createElement('td');
    tdTotal.className = 'c-total';
    if(showTotals){
      const strong = document.createElement('strong');
      strong.textContent = formatMoney(it.total);
      tdTotal.appendChild(strong);
    } else {
      tdTotal.textContent = '';
    }
    tr.appendChild(tdTotal);

    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
  secDiv.appendChild(table);

  // divider (ready for future sections)
  const divLine = document.createElement('div');
  divLine.className = 'pv-divider';
  secDiv.appendChild(divLine);

  pvSections.appendChild(secDiv);
}

/* ===============================
   BUTTONS
================================ */
document.getElementById('btnAddItem').addEventListener('click', () => {
  addItem('');
});

document.getElementById('btnPrint').addEventListener('click', () => {
  // render print layout from current form
  renderPDF();

  // tiny delay to ensure DOM updates before print dialog
  setTimeout(() => window.print(), 50);
});

document.getElementById('btnReset').addEventListener('click', () => {
  document.getElementById('offerTitle').value = 'Cenov√° ponuka';
  document.getElementById('offerSubtitle').value = 'laluna';
  document.getElementById('secName').value = 'Komunik√°cia v ƒçak√°rni pediatra';
  document.getElementById('secPeriod').value = 'Q4 2026';
  document.getElementById('showTotals').value = 'yes';
  itemsWrap.innerHTML = '';
  addItem('B1');
});

/* ===============================
   INIT
================================ */
// default: 2 polo≈æky v sekcii ako tvoj pr√≠klad
addItem('B1');       // B1 + rozmer + default note
addItem('LETAKY');   // let√°ky do stojanov
</script>

</body>
</html>
