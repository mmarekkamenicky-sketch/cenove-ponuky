<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cenov√° ponuka</title>

<!-- FONT: Onest -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ===============================
   BASE
================================ */
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family:"Onest", system-ui, sans-serif;
  background:#fff;
  color:#000;
}
.wrap{
  max-width:1200px;
  margin:0 auto;
  padding:24px;
}
h1{
  margin:0 0 14px 0;
  font-size:28px;
  font-weight:800;
}

/* ===============================
   BUTTONS
================================ */
.toolbar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  margin:12px 0 16px;
}
.btn{
  border-radius:999px;
  padding:10px 16px;
  border:1px solid #000;
  background:#fff;
  font-weight:800;
  cursor:pointer;
}
.btn.primary{
  background:#000;
  color:#fff;
}
.btn.secondary{
  background:#f2f2f2;
  border-color:#d0d0d0;
}
.btn.ghost{
  background:#fff;
  border-color:#d0d0d0;
}
.hint{
  color:#666;
  font-size:13px;
  margin-top:4px;
}

/* ===============================
   FORM ELEMENTS
================================ */
label{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.08em;
  font-weight:800;
  display:block;
  margin-bottom:4px;
  color:#111;
}
input, select, textarea{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #ccc;
  font-family:inherit;
  font-size:14px;
  background:#fff;
}
input[type="number"]{ text-align:right; }
textarea{ min-height:70px; resize:vertical; }
.small{
  font-size:12px;
  color:#666;
}

/* ===============================
   CARDS
================================ */
.card{
  border:1px solid #ddd;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
.card h2{
  margin:0 0 12px 0;
  font-size:18px;
  font-weight:800;
}

/* ===============================
   GRID HELPERS
================================ */
.grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; }
.grid-4{ display:grid; grid-template-columns:2fr 1fr 1fr 1fr; gap:14px; }
@media (max-width: 900px){
  .grid-2,.grid-3,.grid-4{ grid-template-columns:1fr; }
}

/* ===============================
   SECTIONS EDIT
================================ */
.sections{
  display:flex;
  flex-direction:column;
  gap:14px;
}
.section{
  border:1px solid #ddd;
  border-radius:16px;
  padding:14px;
}
.section-head{
  display:flex;
  gap:10px;
  justify-content:space-between;
  align-items:flex-start;
  flex-wrap:wrap;
  margin-bottom:10px;
  padding-bottom:10px;
  border-bottom:1px dashed #ddd;
}
.section-title{
  display:grid;
  grid-template-columns:1fr 200px;
  gap:12px;
  width:100%;
}
@media (max-width: 900px){
  .section-title{ grid-template-columns:1fr; }
}
.section-actions{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:flex-end;
  flex-wrap:wrap;
}
.icon-btn{
  width:40px;
  height:40px;
  border-radius:999px;
  border:1px solid #d0d0d0;
  background:#f2f2f2;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===============================
   ITEM EDIT
================================ */
.items{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:12px;
}
.item{
  border:1px solid #ddd;
  border-radius:14px;
  padding:12px;
}
.item-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}
.item-head .left{
  font-weight:800;
}
.item-foot{
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:12px;
  flex-wrap:wrap;
}
.price-block{
  text-align:right;
  min-width:260px;
}
.price-old{
  font-size:12px;
  color:#777;
  text-decoration:line-through;
  min-height:16px;
}
.price-main{
  font-weight:800;
  font-size:18px;
}
.price-period{
  margin-top:2px;
  font-size:11px;
  color:#777;
}
.preview-row{
  margin-top:10px;
  display:flex;
  gap:12px;
  align-items:flex-start;
  flex-wrap:wrap;
}
.thumb{
  width:120px;
  height:90px;
  border:1px solid #ddd;
  border-radius:12px;
  overflow:hidden;
  background:#f6f6f6;
  display:flex;
  align-items:center;
  justify-content:center;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.note-box{
  margin-top:10px;
}

/* ===============================
   GLOBAL SETTINGS (end)
================================ */
.end-settings{
  border-top:1px dashed #ddd;
  padding-top:12px;
  margin-top:12px;
}

/* ===============================
   PRINT / PDF VIEW
================================ */
.print-view{ display:none; }

.print-page{
  width:210mm;
  min-height:297mm;
  margin:0 auto;
  background:#fff;
  border:2px solid #000;
  padding:18mm 14mm;
  position:relative;
}

/* left gutter for images */
.pv-gutter{
  position:absolute;
  left:14mm;
  top:18mm;
  bottom:18mm;
  width:42mm;
  display:flex;
  flex-direction:column;
  gap:10mm;
}
.pv-gutter .pv-img{
  width:100%;
  border-radius:4mm;
  overflow:hidden;
  border:1px solid #ddd;
  background:#f6f6f6;
}
.pv-gutter .pv-img img{
  width:100%;
  height:auto;
  display:block;
}

/* content shifted right */
.pv-content{ margin-left:48mm; }

/* header */
.pv-header{ margin-bottom:18mm; }
.pv-title{ font-size:34px; font-weight:800; }
.pv-subtitle{ font-size:16px; margin-top:4px; font-weight:500; }

/* section */
.pv-section{ margin-top:14mm; }
.pv-section-name{ font-size:13px; font-weight:700; }
.pv-section-period{ margin-top:2mm; font-size:12px; font-weight:500; color:#111; }

/* table */
.pv-table{
  margin-top:6mm;
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  font-size:11.5px;
}
.pv-table th{
  text-align:left;
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:.08em;
  border-bottom:1px solid #000;
  padding-bottom:6px;
}
.pv-table td{
  padding:8px 0;
  vertical-align:top;
}
.c-item{ width:34%; }
.c-spec{ width:20%; }
.c-qty{ width:10%; text-align:right; }
.c-price{ width:12%; text-align:right; }
.c-disc{ width:12%; text-align:right; }
.c-total{ width:12%; text-align:right; }

.pv-item-title{ font-weight:700; }
.pv-item-note{ font-size:10.5px; margin-top:2px; color:#111; }
.pv-item-extra{ font-size:10px; margin-top:4px; color:#666; }
.pv-item-period{ margin-top:3px; font-size:10px; color:#777; }

.pv-divider{ margin-top:10mm; border-top:1px solid #000; }

.pv-grand{
  margin-top:10mm;
  display:flex;
  justify-content:flex-end;
}
.pv-grand-box{
  width:260px;
  border-top:1px solid #000;
  padding-top:6mm;
  text-align:right;
  font-size:12px;
}
.pv-grand-box .lbl{ color:#111; font-weight:700; }
.pv-grand-box .val{ font-size:16px; font-weight:800; margin-top:2mm; }

/* print rules */
@media print{
  .wrap{ display:none !important; }
  .print-view{ display:block !important; }
  body{ margin:0; }
  @page{ margin:0; }
}
</style>
</head>

<body>

<div class="wrap">
  <h1>Cenov√° ponuka ‚Äì formul√°r</h1>

  <div class="toolbar">
    <button class="btn primary" id="btnPrint" type="button">Export do PDF</button>
    <button class="btn secondary" id="btnAddSection" type="button">+ Prida≈• sekciu</button>
    <button class="btn ghost" id="btnReset" type="button">Vymaza≈• (demo)</button>
  </div>
  <div class="hint">Tip: Typ produktu je voƒæn√Ω text s n√°vrhmi. Pri obr√°zku sa n√°hƒæad vlo≈æ√≠ doƒæava do PDF (gutter) pod seba.</div>

  <!-- Offer base -->
  <div class="card">
    <h2>Z√°klad ponuky</h2>
    <div class="grid-2">
      <div>
        <label for="offerTitle">N√°zov ponuky</label>
        <input id="offerTitle" value="Cenov√° ponuka">
      </div>
      <div>
        <label for="offerSubtitle">Obdobie alebo podnadpis</label>
        <input id="offerSubtitle" placeholder="napr. Q4 2026 ‚Ä¢ n√°zov produktu ‚Ä¢ pozn√°mka" value="">
      </div>
    </div>
  </div>

  <!-- Sections -->
  <div class="card">
    <h2>Sekcie</h2>
    <div class="sections" id="sections"></div>

    <!-- Global end settings -->
    <div class="end-settings">
      <div class="grid-2">
        <div>
          <label for="pdfShowTotals">Zobrazi≈• ‚Äûcena spolu‚Äú v PDF + s√∫ƒçet v≈°etk√Ωch polo≈æiek?</label>
          <select id="pdfShowTotals">
            <option value="yes">√Åno</option>
            <option value="no" selected>Nie</option>
          </select>
          <div class="small">Ak je ‚ÄûNie‚Äú, PDF skryje stƒ∫pec ‚ÄûCena spolu‚Äú aj fin√°lny s√∫ƒçet.</div>
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="btn secondary" id="btnAddSectionBottom" type="button">+ Prida≈• sekciu</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PRINT VIEW -->
<section class="print-view" id="printView">
  <div class="print-page">
    <div class="pv-gutter" id="pvGutter"></div>

    <div class="pv-content">
      <div class="pv-header">
        <div class="pv-title" id="pvTitle">Cenov√° ponuka</div>
        <div class="pv-subtitle" id="pvSubtitle"></div>
      </div>

      <div id="pvSections"></div>
      <div id="pvGrandWrap"></div>
    </div>
  </div>
</section>

<!-- Suggestions list for product type -->
<datalist id="dlTypes">
  <option value="B1 plag√°t"></option>
  <option value="Umiestnenie let√°kov do stojanov IDS"></option>
  <option value="A3 plag√°t"></option>
  <option value="Digit√°lny panel"></option>
  <option value="Let√°kov√Ω stojan"></option>
</datalist>

<template id="tplSection">
  <div class="section" data-section>
    <div class="section-head">
      <div class="section-title">
        <div>
          <label>N√°zov sekcie</label>
          <input data-sec-name placeholder="napr. Komunik√°cia v ƒçak√°rni pediatra" value="">
        </div>
        <div>
          <label>Obdobie (Q)</label>
          <input data-sec-period placeholder="napr. Q4 2026" value="">
        </div>
      </div>

      <div class="section-actions">
        <button class="btn secondary" type="button" data-add-item>+ Polo≈æka</button>
        <button class="icon-btn" type="button" title="Odstr√°ni≈• sekciu" data-del-section>üóëÔ∏è</button>
      </div>
    </div>

    <div class="items" data-items></div>
  </div>
</template>

<template id="tplItem">
  <div class="item" data-item>
    <div class="item-head">
      <div class="left">Polo≈æka</div>
      <button class="icon-btn" type="button" title="Odstr√°ni≈• polo≈æku" data-del-item>üóëÔ∏è</button>
    </div>

    <div class="grid-2">
      <div>
        <label>Typ produktu (voƒæn√Ω text)</label>
        <input data-type list="dlTypes" placeholder="napr. B1 plag√°t">
        <div class="small">Tip: keƒè nap√≠≈°e≈° presne ‚ÄûB1 plag√°t‚Äú, automaticky nastav√≠me rozmer 70 √ó 100 cm.</div>
      </div>
      <div>
        <label>Rozmer</label>
        <input data-dim placeholder="‚Äî">
      </div>
    </div>

    <div class="grid-2" style="margin-top:12px;">
      <div>
        <label>N√°zov polo≈æky (prep√≠sateƒæn√©)</label>
        <input data-title placeholder="napr. B1 plag√°t">
      </div>
      <div>
        <label>Doplnenie / pozn√°mka (voliteƒæn√©)</label>
        <input data-note placeholder="napr. + umiestnenie let√°kov do u≈°ka">
      </div>
    </div>

    <div class="grid-3" style="margin-top:12px;">
      <div>
        <label>Cena za kus</label>
        <input data-price type="number" min="0" step="0.01" placeholder="0.00">
      </div>
      <div>
        <label>Zv√Ωhodnen√° cena za kus</label>
        <input data-discount type="number" min="0" step="0.01" placeholder="0.00">
      </div>
      <div>
        <label>Poƒçet</label>
        <div class="grid-2" style="grid-template-columns: 1fr 1fr; gap:10px;">
          <select data-qtymode title="Re≈æim poƒçtu">
            <option value="exact" selected>Presn√Ω</option>
            <option value="max">Max</option>
          </select>
          <input data-qty type="number" min="0" step="1" value="1">
        </div>
      </div>
    </div>

    <div class="item-foot">
      <div style="min-width:260px;">
        <label>Obdobie pod cenou</label>
        <input data-period value="za 3 mesiace">
      </div>

      <div class="price-block">
        <div class="price-old" data-old></div>
        <div class="price-main" data-total>0,00 ‚Ç¨</div>
        <div class="price-period">(poƒç√≠tan√© z jednotkovej ceny)</div>
      </div>
    </div>

    <div class="preview-row">
      <div>
        <label>Obr√°zok (voliteƒæn√©)</label>
        <input data-img type="file" accept="image/*">
        <div class="small">V PDF sa obr√°zky skladaj√∫ doƒæava pod seba.</div>
      </div>

      <div class="thumb" data-thumb>
        <span class="small">bez obr√°zka</span>
      </div>
    </div>

    <div class="note-box">
      <label>Vlastn√° pozn√°mka pod polo≈ækou (voliteƒæn√©)</label>
      <textarea data-extra placeholder="napr. S√∫ƒças≈•ou je fotodokument√°cia a zoznam, kde sa materi√°l odovzdal."></textarea>
    </div>
  </div>
</template>

<script>
/* ===============================
   UTIL
================================ */
const moneyFmt = new Intl.NumberFormat('sk-SK', { style:'currency', currency:'EUR' });
function n(v){ const x = Number(v); return Number.isFinite(x) ? x : 0; }
function formatMoney(val){ return moneyFmt.format(val); }

/* Presets */
function presetFromType(rawType){
  const t = (rawType || '').trim().toLowerCase();

  // B1 exact match style (can be expanded later)
  if(t === 'b1 plag√°t' || t === 'b1 plakat' || t === 'b1'){
    return { dim:'70 √ó 100 cm', title:'B1 plag√°t', note:'+ umiestnenie let√°kov do u≈°ka' };
  }

  if(t.includes('stojan') || t.includes('umiestnenie let√°kov')){
    return { dim:'', title:'Umiestnenie let√°kov do stojanov IDS', note:'' };
  }

  return { dim:'', title:'', note:'' };
}

/* ===============================
   DOM REFS
================================ */
const sectionsWrap = document.getElementById('sections');
const tplSection = document.getElementById('tplSection');
const tplItem = document.getElementById('tplItem');

/* ===============================
   ITEM LOGIC
================================ */
function recalcItem(itemEl){
  const price = n(itemEl.querySelector('[data-price]').value);
  const discount = n(itemEl.querySelector('[data-discount]').value);
  const qty = n(itemEl.querySelector('[data-qty]').value);
  const qtyMode = itemEl.querySelector('[data-qtymode]').value;

  const unit = discount > 0 ? discount : price;
  const total = unit * qty;

  const totalEl = itemEl.querySelector('[data-total]');
  totalEl.textContent = (qtyMode === 'max') ? ('max. ' + formatMoney(total)) : formatMoney(total);

  const oldEl = itemEl.querySelector('[data-old]');
  if(discount > 0 && price > 0){
    oldEl.textContent = formatMoney(price);
  } else {
    oldEl.textContent = '';
  }
}

function setThumb(itemEl, dataUrl){
  const thumb = itemEl.querySelector('[data-thumb]');
  thumb.innerHTML = '';
  if(!dataUrl){
    thumb.innerHTML = '<span class="small">bez obr√°zka</span>';
    itemEl.dataset.img = '';
    return;
  }
  const img = document.createElement('img');
  img.src = dataUrl;
  thumb.appendChild(img);
  itemEl.dataset.img = dataUrl; // store for PDF gutter
}

function wireItem(itemEl){
  const typeInput = itemEl.querySelector('[data-type]');
  const dimEl = itemEl.querySelector('[data-dim]');
  const titleEl = itemEl.querySelector('[data-title]');
  const noteEl = itemEl.querySelector('[data-note]');
  const imgInput = itemEl.querySelector('[data-img]');

  // preset on type blur/change
  function applyPreset(){
    const p = presetFromType(typeInput.value);

    // dimension: always set if preset has it, otherwise keep current (unless empty)
    if(p.dim) dimEl.value = p.dim;

    // title default only if empty
    if(!titleEl.value && p.title) titleEl.value = p.title;

    // note default only if empty
    if(!noteEl.value && p.note) noteEl.value = p.note;
  }

  typeInput.addEventListener('change', () => { applyPreset(); recalcItem(itemEl); });
  typeInput.addEventListener('blur', () => { applyPreset(); recalcItem(itemEl); });

  // recalc on inputs
  itemEl.querySelectorAll('input, select, textarea').forEach(el => {
    if(el.matches('[data-img]')) return;
    el.addEventListener('input', () => recalcItem(itemEl));
    el.addEventListener('change', () => recalcItem(itemEl));
  });

  // image upload
  imgInput.addEventListener('change', async () => {
    const f = imgInput.files && imgInput.files[0];
    if(!f){ setThumb(itemEl, ''); return; }
    const reader = new FileReader();
    reader.onload = () => setThumb(itemEl, String(reader.result || ''));
    reader.readAsDataURL(f);
  });

  // delete
  itemEl.querySelector('[data-del-item]').addEventListener('click', () => {
    itemEl.remove();
  });

  // init
  setThumb(itemEl, '');
  recalcItem(itemEl);
}

function addItem(itemsWrap){
  const node = tplItem.content.cloneNode(true);
  itemsWrap.appendChild(node);
  const itemEl = itemsWrap.lastElementChild;
  wireItem(itemEl);
}

/* ===============================
   SECTION LOGIC
================================ */
function addSection(){
  const node = tplSection.content.cloneNode(true);
  sectionsWrap.appendChild(node);
  const secEl = sectionsWrap.lastElementChild;

  const itemsWrap = secEl.querySelector('[data-items]');

  secEl.querySelector('[data-add-item]').addEventListener('click', () => addItem(itemsWrap));
  secEl.querySelector('[data-del-section]').addEventListener('click', () => secEl.remove());

  // default: one empty item
  addItem(itemsWrap);
}

/* ===============================
   PDF RENDER
================================ */
function collectState(){
  const title = document.getElementById('offerTitle').value.trim() || 'Cenov√° ponuka';
  const subtitle = document.getElementById('offerSubtitle').value.trim();
  const showTotals = document.getElementById('pdfShowTotals').value === 'yes';

  const sections = [];
  sectionsWrap.querySelectorAll('[data-section]').forEach(secEl => {
    const secName = secEl.querySelector('[data-sec-name]').value.trim();
    const secPeriod = secEl.querySelector('[data-sec-period]').value.trim();
    const items = [];

    secEl.querySelectorAll('[data-item]').forEach(itemEl => {
      const type = itemEl.querySelector('[data-type]').value.trim();
      const dim = itemEl.querySelector('[data-dim]').value.trim();
      const title = itemEl.querySelector('[data-title]').value.trim();
      const note = itemEl.querySelector('[data-note]').value.trim();
      const extra = itemEl.querySelector('[data-extra]').value.trim();

      const price = n(itemEl.querySelector('[data-price]').value);
      const discount = n(itemEl.querySelector('[data-discount]').value);
      const qtyMode = itemEl.querySelector('[data-qtymode]').value;
      const qty = n(itemEl.querySelector('[data-qty]').value);
      const period = itemEl.querySelector('[data-period]').value.trim() || 'za 3 mesiace';

      const unit = (discount > 0) ? discount : price;
      const total = unit * qty;

      const img = itemEl.dataset.img || '';

      items.push({
        type, dim, title, note, extra,
        price, discount, qtyMode, qty, total, period,
        img
      });
    });

    sections.push({ secName, secPeriod, items });
  });

  return { title, subtitle, showTotals, sections };
}

function renderPDF(){
  const state = collectState();

  // header
  document.getElementById('pvTitle').textContent = state.title;
  document.getElementById('pvSubtitle').textContent = state.subtitle;

  // gutter images (stack all images from all items)
  const pvGutter = document.getElementById('pvGutter');
  pvGutter.innerHTML = '';
  state.sections.forEach(s => {
    s.items.forEach(it => {
      if(!it.img) return;
      const box = document.createElement('div');
      box.className = 'pv-img';
      const img = document.createElement('img');
      img.src = it.img;
      box.appendChild(img);
      pvGutter.appendChild(box);
    });
  });

  // sections
  const pvSections = document.getElementById('pvSections');
  pvSections.innerHTML = '';

  let grandTotal = 0;

  state.sections.forEach((s, idx) => {
    const secDiv = document.createElement('div');
    secDiv.className = 'pv-section';

    const name = document.createElement('div');
    name.className = 'pv-section-name';
    name.textContent = s.secName || '';
    secDiv.appendChild(name);

    const per = document.createElement('div');
    per.className = 'pv-section-period';
    per.textContent = s.secPeriod || '';
    secDiv.appendChild(per);

    const table = document.createElement('table');
    table.className = 'pv-table';

    const thead = document.createElement('thead');
    const trh = document.createElement('tr');

    // Headers always include, but total column will be visually empty if showTotals=no
    const headers = [
      { cls:'c-item', txt:'Polo≈æka' },
      { cls:'c-spec', txt:'≈†pecifik√°cia' },
      { cls:'c-qty', txt:'Poƒçet' },
      { cls:'c-price', txt:'Cena' },
      { cls:'c-disc', txt:'Zv√Ωh. cena' },
      { cls:'c-total', txt:'Cena spolu' }
    ];
    headers.forEach(h => {
      const th = document.createElement('th');
      th.className = h.cls;
      th.textContent = h.txt;
      trh.appendChild(th);
    });
    thead.appendChild(trh);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');

    s.items.forEach(it => {
      const tr = document.createElement('tr');

      // item
      const tdItem = document.createElement('td');
      tdItem.className = 'c-item';

      const t = document.createElement('div');
      t.className = 'pv-item-title';
      t.textContent = it.title || it.type || '‚Äî';
      tdItem.appendChild(t);

      if(it.note){
        const nn = document.createElement('div');
        nn.className = 'pv-item-note';
        nn.textContent = it.note;
        tdItem.appendChild(nn);
      }

      if(it.extra){
        const ex = document.createElement('div');
        ex.className = 'pv-item-extra';
        ex.textContent = it.extra;
        tdItem.appendChild(ex);
      }

      const pp = document.createElement('div');
      pp.className = 'pv-item-period';
      pp.textContent = it.period || 'za 3 mesiace';
      tdItem.appendChild(pp);

      tr.appendChild(tdItem);

      // spec
      const tdSpec = document.createElement('td');
      tdSpec.className = 'c-spec';
      tdSpec.textContent = it.dim || '';
      tr.appendChild(tdSpec);

      // qty
      const tdQty = document.createElement('td');
      tdQty.className = 'c-qty';
      tdQty.textContent = it.qtyMode === 'max' ? ('max. ' + (it.qty || 0)) : String(it.qty || 0);
      tr.appendChild(tdQty);

      // price column (old price shown when discount present)
      const tdPrice = document.createElement('td');
      tdPrice.className = 'c-price';
      if(it.discount > 0 && it.price > 0){
        const old = document.createElement('div');
        old.style.textDecoration = 'line-through';
        old.style.color = '#777';
        old.style.fontSize = '10.5px';
        old.textContent = formatMoney(it.price);
        tdPrice.appendChild(old);
      } else {
        tdPrice.textContent = it.price > 0 ? formatMoney(it.price) : '';
      }
      tr.appendChild(tdPrice);

      // discount
      const tdDisc = document.createElement('td');
      tdDisc.className = 'c-disc';
      tdDisc.textContent = it.discount > 0 ? formatMoney(it.discount) : '';
      tr.appendChild(tdDisc);

      // total
      const tdTotal = document.createElement('td');
      tdTotal.className = 'c-total';
      if(state.showTotals){
        const strong = document.createElement('strong');
        strong.textContent = it.qtyMode === 'max' ? ('max. ' + formatMoney(it.total)) : formatMoney(it.total);
        tdTotal.appendChild(strong);

        // add to grand
        grandTotal += it.total;
      } else {
        tdTotal.textContent = '';
      }
      tr.appendChild(tdTotal);

      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    secDiv.appendChild(table);

    // divider between sections
    const divLine = document.createElement('div');
    divLine.className = 'pv-divider';
    secDiv.appendChild(divLine);

    pvSections.appendChild(secDiv);
  });

  // grand total at end
  const pvGrandWrap = document.getElementById('pvGrandWrap');
  pvGrandWrap.innerHTML = '';
  if(state.showTotals){
    const grand = document.createElement('div');
    grand.className = 'pv-grand';
    const box = document.createElement('div');
    box.className = 'pv-grand-box';
    box.innerHTML = `<div class="lbl">Spolu</div><div class="val">${formatMoney(grandTotal)}</div>`;
    grand.appendChild(box);
    pvGrandWrap.appendChild(grand);
  }
}

/* ===============================
   BUTTONS
================================ */
document.getElementById('btnAddSection').addEventListener('click', () => addSection());
document.getElementById('btnAddSectionBottom').addEventListener('click', () => addSection());

document.getElementById('btnPrint').addEventListener('click', () => {
  renderPDF();
  setTimeout(() => window.print(), 80);
});

document.getElementById('btnReset').addEventListener('click', () => {
  document.getElementById('offerTitle').value = 'Cenov√° ponuka';
  document.getElementById('offerSubtitle').value = '';
  document.getElementById('pdfShowTotals').value = 'no';
  sectionsWrap.innerHTML = '';
  addSection();
});

/* ===============================
   INIT
================================ */
addSection();
</script>

</body>
</html>
